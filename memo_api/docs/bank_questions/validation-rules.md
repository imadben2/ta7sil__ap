# قواعد التحقق من صحة البيانات

## نظرة عامة

يطبق النظام مجموعة من القواعد للتحقق من صحة البيانات قبل استيراد الأسئلة. هذه القواعد تضمن جودة الأسئلة واتساقها.

---

## قواعد عامة

### 1. question_text_ar (نص السؤال)
- ✅ **مطلوب**: يجب تعبئته
- ✅ **نوع البيانات**: نص
- ✅ **الحد الأقصى**: 1000 حرف
- ❌ **لا يمكن**: أن يكون فارغاً أو يحتوي على مسافات فقط

**رسائل الخطأ**:
```
نص السؤال مطلوب في السطر X
نص السؤال يجب أن لا يتجاوز 1000 حرف في السطر X
```

### 2. question_type (نوع السؤال)
- ✅ **مطلوب**: يجب تعبئته
- ✅ **القيم المقبولة فقط**:
  - `single_choice` أو `mcq_single`
  - `multiple_choice` أو `mcq_multiple`
  - `true_false`
  - `short_answer`
- ❌ **لا يمكن**: استخدام أي قيمة أخرى

**رسائل الخطأ**:
```
نوع السؤال مطلوب في السطر X
نوع السؤال غير صحيح: [VALUE]. الأنواع المسموحة: single_choice, multiple_choice, true_false, short_answer
```

### 3. points (النقاط)
- ✅ **مطلوب**: يجب تعبئته
- ✅ **نوع البيانات**: رقم صحيح
- ✅ **الحد الأدنى**: 1
- ✅ **القيمة الافتراضية**: 1 (إذا تُركت فارغة)
- ❌ **لا يمكن**: أن يكون صفر أو سالب أو نص

**رسائل الخطأ**:
```
يجب أن تكون النقاط أكبر من أو تساوي 1 في السطر X
النقاط يجب أن تكون رقم صحيح في السطر X
```

### 4. difficulty (مستوى الصعوبة)
- ❌ **اختياري**: يمكن تركه فارغاً
- ✅ **القيم المقبولة** (إذا تم تعبئته):
  - `easy` أو `سهل`
  - `medium` أو `متوسط`
  - `hard` أو `صعب`
- ✅ **التحويل التلقائي**: يتم تحويل القيم العربية إلى إنجليزية

**ملاحظة**: إذا كانت القيمة غير صحيحة، سيتم تجاهلها (لن تحدث خطأ).

---

## قواعد خاصة بأسئلة الاختيار من متعدد

### MCQ Single Choice & Multiple Choice

#### الخيارات (Options)
- ✅ **مطلوب**: خياران على الأقل (option_1, option_2)
- ✅ **الحد الأقصى**: 4 خيارات
- ❌ **لا يمكن**: ترك جميع الخيارات فارغة

**رسائل الخطأ**:
```
يجب أن يكون هناك خياران على الأقل للأسئلة متعددة الخيارات في السطر X
```

#### الإجابة الصحيحة (Single Choice)
- ✅ **مطلوب**: يجب تعبئته
- ✅ **الصيغ المقبولة**:
  - رقم: `1`, `2`, `3`, `4`
  - حرف: `A`, `B`, `C`, `D` (غير حساس لحالة الأحرف)
  - نص الخيار: يجب أن يطابق تماماً أحد الخيارات
- ❌ **لا يمكن**: استخدام رقم خارج النطاق (5, 6...)

**رسائل الخطأ**:
```
الإجابة الصحيحة مطلوبة في السطر X
رقم الإجابة الصحيحة يجب أن يكون بين 1 و 4 في السطر X
الإجابة الصحيحة غير صحيحة في السطر X. استخدم رقم (1-4) أو حرف (A-D) أو نص الخيار
```

#### الإجابة الصحيحة (Multiple Choice)
- ✅ **مطلوب**: يجب تعبئته
- ✅ **الصيغ المقبولة**:
  - أرقام مفصولة بفاصلة: `1,3` أو `1,2,4`
  - حروف مفصولة بفاصلة: `A,C` أو `A,B,D`
  - نصوص الخيارات مفصولة بفاصلة
- ✅ **إجابة واحدة على الأقل**: يجب تحديد إجابة صحيحة واحدة على الأقل
- ❌ **لا يمكن**: تكرار نفس الإجابة

**رسائل الخطأ**:
```
الإجابات الصحيحة مطلوبة في السطر X
يجب تحديد إجابة صحيحة واحدة على الأقل في السطر X
الإجابة '[VALUE]' غير صحيحة في السطر X
```

---

## قواعد خاصة بأسئلة صح/خطأ

### True/False

#### الإجابة الصحيحة
- ✅ **مطلوب**: يجب تعبئته
- ✅ **القيم المقبولة فقط**:
  - للصحيح: `true`, `صحيح`, `1`
  - للخطأ: `false`, `خطأ`, `0`
- ❌ **لا يمكن**: استخدام أي قيمة أخرى

**رسائل الخطأ**:
```
الإجابة يجب أن تكون 'true' أو 'false' (أو 'صحيح'/'خطأ') في السطر X
```

---

## قواعد خاصة بأسئلة الإجابة القصيرة

### Short Answer

#### الإجابة النموذجية
- ✅ **مطلوب**: يجب تعبئته
- ✅ **نوع البيانات**: نص
- ❌ **لا يمكن**: أن يكون فارغاً

**رسائل الخطأ**:
```
الإجابة النموذجية مطلوبة في السطر X
```

#### الكلمات المفتاحية (keywords)
- ❌ **اختياري**: يمكن تركه فارغاً
- ✅ **التنسيق**: كلمات مفصولة بفاصلة
- ✅ **مثال**: `الجزائر,algiers,capital`

---

## قواعد إضافية

### الصور (question_image_url)
- ❌ **اختياري**: يمكن تركه فارغاً
- ✅ **التنسيق**: URL صحيح إذا تم تعبئته
- ✅ **مثال**: `https://example.com/image.jpg`

### الشرح (explanation_ar)
- ❌ **اختياري**: يمكن تركه فارغاً
- ✅ **نوع البيانات**: نص
- ✅ **الحد الأقصى**: غير محدود (لكن يُنصح بـ 500 حرف)

### الوسوم (tags)
- ❌ **اختياري**: يمكن تركه فارغاً
- ✅ **التنسيق**: وسوم مفصولة بفاصلة
- ✅ **مثال**: `رياضيات,جمع,أرقام`

---

## أمثلة على الأخطاء الشائعة

### ❌ خطأ 1: نوع سؤال خاطئ
```
السطر 5: نوع السؤال غير صحيح: mcq. الأنواع المسموحة: single_choice, multiple_choice, true_false, short_answer
```

**الحل**: استخدم `single_choice` بدلاً من `mcq`

### ❌ خطأ 2: إجابة صحيحة غير موجودة
```
السطر 8: الإجابة الصحيحة غير صحيحة في السطر 8. استخدم رقم (1-4) أو حرف (A-D) أو نص الخيار
```

**الحل**: تأكد من أن الإجابة الصحيحة تطابق أحد الخيارات

### ❌ خطأ 3: نقاط سالبة
```
السطر 12: يجب أن تكون النقاط أكبر من أو تساوي 1 في السطر 12
```

**الحل**: استخدم 1 أو أكثر للنقاط

### ❌ خطأ 4: خيارات ناقصة
```
السطر 15: يجب أن يكون هناك خياران على الأقل للأسئلة متعددة الخيارات في السطر 15
```

**الحل**: أضف خياران على الأقل (option_1, option_2)

---

## التحقق قبل الرفع

### قائمة التحقق السريعة

قبل رفع ملف Excel، تأكد من:

- [ ] جميع الأعمدة المطلوبة مملوءة
- [ ] أنواع الأسئلة صحيحة تماماً
- [ ] الإجابات الصحيحة بالتنسيق الصحيح
- [ ] النقاط أرقام صحيحة موجبة
- [ ] الخيارات مكتملة لأسئلة الاختيار
- [ ] لا توجد أسطر فارغة بين الأسئلة
- [ ] لا توجد أحرف خاصة غريبة في البيانات

---

## آلية التحقق

### المراحل
1. **تحقق أولي**: عند رفع الملف (نوع الملف، الحجم)
2. **تحقق من الهيكل**: التأكد من وجود الأعمدة المطلوبة
3. **تحقق من كل صف**: التحقق من صحة البيانات في كل سطر
4. **تحقق نهائي**: التأكد من عدم وجود تكرارات أو تعارضات

### سياسة الفشل
- ❌ **لا استيراد جزئي**: إذا فشل سطر واحد، لن يتم استيراد أي أسئلة
- ✅ **تقرير شامل**: ستحصل على قائمة بجميع الأخطاء
- ✅ **حماية البيانات**: يحمي من استيراد بيانات غير صحيحة

---

## نصائح لتجنب الأخطاء

1. **استخدم القالب الرسمي**: دائماً ابدأ بتنزيل القالب
2. **تحقق من كل سطر**: قبل الانتقال للسطر التالي
3. **انسخ والصق بحذر**: لا تنسخ التنسيقات، فقط النصوص
4. **احفظ باستمرار**: لتجنب فقدان العمل
5. **جرب بملف صغير أولاً**: اختبر بـ 5-10 أسئلة قبل الملف الكامل
